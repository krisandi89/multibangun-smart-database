<!DOCTYPE html>
<html lang="id">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multibangun Smart Database - Geosintetik Solutions</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <meta name="description"
        content="Database produk geosintetik PT. Multibangun Rekatama Patria - Distributor resmi Tensar International">

    <!-- Preconnect to CDNs for faster loading -->
    <link rel="preconnect" href="https://cdn.jsdelivr.net">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Tailwind CSS v3 (stable, compatible) -->
    <script src="https://cdn.tailwindcss.com/3.4.1"></script>

    <!-- React from jsDelivr -->
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone@7/babel.min.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap');

        * {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
        }

        /* Dark mode variables */
        :root {
            --bg-primary: #f8fafc;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --border-color: #e2e8f0;
            --search-bg: #ffffff;
        }

        .dark {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-card: #1e293b;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
            --text-muted: #64748b;
            --border-color: #334155;
            --search-bg: #1e293b;
        }

        body {
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-secondary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--text-muted);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--text-secondary);
        }

        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, #dc2626 0%, #ef4444 50%, #f87171 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        /* Spotlight glow */
        .spotlight-glow {
            background: var(--search-bg);
            box-shadow: 0 0 0 1px var(--border-color),
                0 4px 6px -1px rgba(0, 0, 0, 0.1),
                0 20px 40px -10px rgba(0, 0, 0, 0.1);
        }

        .dark .spotlight-glow {
            box-shadow: 0 0 0 1px var(--border-color),
                0 4px 6px -1px rgba(0, 0, 0, 0.3),
                0 20px 40px -10px rgba(0, 0, 0, 0.3);
        }

        .spotlight-glow:focus-within {
            box-shadow: 0 0 0 3px rgba(220, 38, 38, 0.3),
                0 4px 6px -1px rgba(0, 0, 0, 0.1),
                0 25px 50px -12px rgba(0, 0, 0, 0.15);
        }

        /* Card styles */
        .card-hover {
            background: var(--bg-card);
            border-color: var(--border-color);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.2);
        }

        /* File type badge colors */
        .badge-brosur {
            background: #dbeafe;
            color: #1e40af;
        }

        .badge-spesifikasi {
            background: #dcfce7;
            color: #166534;
        }

        .badge-metode {
            background: #fef3c7;
            color: #92400e;
        }

        .badge-hasil-uji {
            background: #f3e8ff;
            color: #6b21a8;
        }

        .badge-sertifikasi {
            background: #fce7f3;
            color: #9d174d;
        }

        .badge-case-history {
            background: #e0e7ff;
            color: #3730a3;
        }

        .badge-presentasi {
            background: #ffedd5;
            color: #c2410c;
        }

        .dark .badge-brosur {
            background: #1e3a5f;
            color: #93c5fd;
        }

        .dark .badge-spesifikasi {
            background: #14532d;
            color: #86efac;
        }

        .dark .badge-metode {
            background: #451a03;
            color: #fcd34d;
        }

        .dark .badge-hasil-uji {
            background: #3b0764;
            color: #d8b4fe;
        }

        .dark .badge-sertifikasi {
            background: #500724;
            color: #f9a8d4;
        }

        .dark .badge-case-history {
            background: #1e1b4b;
            color: #a5b4fc;
        }

        .dark .badge-presentasi {
            background: #431407;
            color: #fdba74;
        }

        /* Bottom Sheet Animation */
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }

            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .animate-slide-up {
            animation: slideUp 0.3s ease-out forwards;
        }

        /* Theme toggle */
        .theme-toggle {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 100;
            padding: 0.75rem;
            border-radius: 0.75rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            cursor: pointer;
            transition: all 0.2s;
        }

        .theme-toggle:hover {
            transform: scale(1.05);
        }
    </style>
</head>

<body class="min-h-screen">

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef, useMemo } = React;

        // ==================== ICONS ====================
        const Icons = {
            Search: ({ className = "w-6 h-6" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <circle cx="11" cy="11" r="8" />
                    <line x1="21" y1="21" x2="16.65" y2="16.65" />
                </svg>
            ),
            Download: ({ className = "w-4 h-4" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                    <polyline points="7 10 12 15 17 10" />
                    <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
            ),
            X: ({ className = "w-5 h-5" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <line x1="18" y1="6" x2="6" y2="18" />
                    <line x1="6" y1="6" x2="18" y2="18" />
                </svg>
            ),
            Star: ({ className = "w-4 h-4" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" />
                </svg>
            ),
            FileText: ({ className = "w-4 h-4" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                    <polyline points="14 2 14 8 20 8" />
                    <line x1="16" y1="13" x2="8" y2="13" />
                    <line x1="16" y1="17" x2="8" y2="17" />
                    <polyline points="10 9 9 9 8 9" />
                </svg>
            ),
            Phone: ({ className = "w-5 h-5" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.361 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.339 1.85.573 2.81.7A2 2 0 0 1 22 16.92z" />
                </svg>
            ),
            Folder: ({ className = "w-4 h-4" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z" />
                </svg>
            ),
            ChevronRight: ({ className = "w-4 h-4" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <polyline points="9 18 15 12 9 6" />
                </svg>
            ),
            Command: ({ className = "w-3 h-3" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M18 3a3 3 0 0 0-3 3v12a3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3H6a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3V6a3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3h12a3 3 0 0 0 3-3 3 3 0 0 0-3-3z" />
                </svg>
            ),
            ExternalLink: ({ className = "w-3 h-3" }) => (
                <svg xmlns="http://www.w3.org/2000/svg" className={className} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6" />
                    <polyline points="15 3 21 3 21 9" />
                    <line x1="10" y1="14" x2="21" y2="3" />
                </svg>
            )
        };

        // ==================== FILE TYPE CONFIG ====================
        const fileTypeConfig = {
            'brosur': { label: 'Brosur', badge: 'badge-brosur', icon: 'üìÑ' },
            'spesifikasi': { label: 'Spesifikasi', badge: 'badge-spesifikasi', icon: 'üìã' },
            'metode': { label: 'Metode', badge: 'badge-metode', icon: 'üîß' },
            'hasil-uji': { label: 'Hasil Uji', badge: 'badge-hasil-uji', icon: 'üß™' },
            'sertifikasi': { label: 'Sertifikasi', badge: 'badge-sertifikasi', icon: '‚úÖ' },
            'case-history': { label: 'Case History', badge: 'badge-case-history', icon: 'üìö' },
            'presentasi': { label: 'Presentasi', badge: 'badge-presentasi', icon: 'üìä' },
        };

        // ==================== CATEGORY CONFIG ====================
        const categoryConfig = {
            'company-profile': { label: 'Company Profile', color: 'bg-slate-600' },
            'geogrid': { label: 'Geogrid', color: 'bg-blue-600' },
            'geomembrane': { label: 'Geomembrane', color: 'bg-emerald-600' },
            'geotextile': { label: 'Geotextile', color: 'bg-purple-600' },
            'retaining-wall': { label: 'Retaining Wall', color: 'bg-amber-600' },
            'erosion-control': { label: 'Kontrol Erosi', color: 'bg-green-600' },
            'presentasi': { label: 'Presentasi', color: 'bg-orange-600' },
            'geocell': { label: 'Geocell', color: 'bg-cyan-600' },
            'asphalt': { label: 'Asphalt', color: 'bg-rose-600' },
        };

        // ==================== COMPONENTS ====================

        // Category Filter Pill
        const CategoryPill = ({ category, isActive, onClick, count }) => {
            const config = categoryConfig[category.id] || { label: category.name, color: 'bg-gray-600' };
            return (
                <button
                    onClick={onClick}
                    className={`px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 flex items-center gap-2 ${isActive
                        ? `${config.color} text-white shadow-lg`
                        : 'bg-white text-slate-600 hover:bg-slate-50 border border-slate-200 hover:border-slate-300'
                        }`}
                >
                    {config.label}
                    {count > 0 && (
                        <span className={`text-xs px-1.5 py-0.5 rounded-full ${isActive ? 'bg-white/20' : 'bg-slate-100'}`}>
                            {count}
                        </span>
                    )}
                </button>
            );
        };

        // File Download Button - Shows full file name
        const FileButton = ({ file, onDownload }) => {
            const config = fileTypeConfig[file.type] || { label: file.type, badge: 'badge-brosur', icon: 'üìÑ' };
            // Remove .pdf extension for cleaner display
            const displayName = file.name.replace(/\.pdf$/i, '');
            return (
                <button
                    onClick={() => onDownload(file)}
                    className={`group flex items-center gap-2 px-3 py-2 rounded-lg text-xs font-medium transition-all duration-200 ${config.badge} hover:scale-105 hover:shadow-md max-w-full`}
                    title={file.name}
                >
                    <span className="flex-shrink-0">{config.icon}</span>
                    <span className="truncate">{displayName}</span>
                    <Icons.Download className="w-3 h-3 flex-shrink-0 opacity-0 group-hover:opacity-100 transition-opacity" />
                </button>
            );
        };



        // Product Card
        const ProductCard = ({ item, onDownload }) => {
            const catConfig = categoryConfig[item.category] || { label: item.category, color: 'bg-gray-600' };

            return (
                <div className="rounded-2xl shadow-sm border overflow-hidden card-hover animate-fade-in flex flex-col h-full" style={{ background: 'var(--bg-card)', borderColor: 'var(--border-color)' }}>
                    {/* Header */}
                    <div className="p-5 pb-3 flex-1">
                        <div className="flex items-start justify-between mb-3">
                            <span className={`text-[10px] font-bold px-2.5 py-1 rounded-full text-white uppercase tracking-wider ${catConfig.color}`}>
                                {catConfig.label}
                            </span>
                            {item.highlight && (
                                <span className="flex items-center gap-1 text-amber-500" title="Featured Product">
                                    <Icons.Star className="w-4 h-4" />
                                </span>
                            )}
                        </div>

                        <h3 className="text-lg font-bold mb-2 leading-tight transition-colors" style={{ color: 'var(--text-primary)' }}>
                            {item.title}
                        </h3>

                        {item.subcategory && (
                            <p className="text-xs text-slate-400 mb-2 flex items-center gap-1">
                                <Icons.Folder className="w-3 h-3" />
                                {item.subcategory}
                            </p>
                        )}

                        <p className="text-sm leading-relaxed mb-4 line-clamp-2" style={{ color: 'var(--text-secondary)' }}>
                            {item.description}
                        </p>

                        {/* Tags */}
                        <div className="flex flex-wrap gap-1.5 mb-3">
                            {item.tags.slice(0, 4).map((tag, idx) => (
                                <span key={idx} className="text-[10px] px-2 py-0.5 rounded-full" style={{ background: 'var(--bg-secondary)', color: 'var(--text-muted)' }}>
                                    #{tag}
                                </span>
                            ))}
                            {item.tags.length > 4 && (
                                <span className="text-[10px] text-slate-400">+{item.tags.length - 4}</span>
                            )}
                        </div>
                    </div>

                    {/* Files Section */}
                    <div className="p-4 border-t" style={{ background: 'var(--bg-secondary)', borderColor: 'var(--border-color)' }}>
                        <p className="text-[10px] uppercase tracking-wider text-slate-400 font-medium mb-2">
                            {item.files.length} file tersedia
                        </p>
                        <div className="flex flex-wrap gap-2">
                            {item.files.map((file, idx) => (
                                <FileButton key={idx} file={file} onDownload={onDownload} />
                            ))}
                        </div>
                    </div>
                </div>
            );
        };

        // Empty State - No Results
        const EmptyState = ({ query }) => (
            <div className="text-center py-20 animate-fade-in">
                <div className="inline-flex items-center justify-center w-20 h-20 rounded-full bg-gradient-to-br from-slate-100 to-slate-200 mb-6">
                    <Icons.Search className="w-10 h-10 text-slate-400" />
                </div>
                <h3 className="text-xl font-bold text-slate-700 mb-3">
                    Tidak ditemukan hasil untuk "{query}"
                </h3>
                <p className="text-slate-500 max-w-md mx-auto mb-8">
                    Data mungkin belum tersedia di database. Tim engineering kami siap membantu Anda menemukan solusi.
                </p>
                <a
                    href="https://wa.me/6281112345678"
                    target="_blank"
                    rel="noreferrer"
                    className="inline-flex items-center gap-3 px-8 py-4 bg-gradient-to-r from-green-500 to-green-600 text-white rounded-full font-semibold hover:from-green-600 hover:to-green-700 transition-all shadow-lg hover:shadow-green-200 hover:scale-105"
                >
                    <Icons.Phone className="w-5 h-5" />
                    Hubungi Sales Engineer
                </a>
            </div>
        );

        // Initial State - Start Searching
        const InitialState = () => (
            <div className="text-center py-20 animate-fade-in">
                <div className="inline-flex items-center justify-center w-24 h-24 rounded-full bg-gradient-to-br from-red-50 to-red-100 dark:from-red-900/20 dark:to-red-800/20 mb-6">
                    <Icons.Search className="w-12 h-12 text-red-400" />
                </div>
                <h3 className="text-2xl font-bold mb-3" style={{ color: 'var(--text-primary)' }}>
                    Mulai Pencarian
                </h3>
                <p className="max-w-md mx-auto mb-6" style={{ color: 'var(--text-secondary)' }}>
                    Ketik di searchbar untuk mencari produk. Gunakan kata kunci seperti nama produk, jenis file, atau kategori.
                </p>
                <div className="flex items-center justify-center gap-2 text-sm" style={{ color: 'var(--text-muted)' }}>
                    <kbd className="px-2 py-1 rounded bg-slate-100 dark:bg-slate-800 font-mono text-xs">Ctrl</kbd>
                    <span>+</span>
                    <kbd className="px-2 py-1 rounded bg-slate-100 dark:bg-slate-800 font-mono text-xs">K</kbd>
                    <span className="ml-2">untuk fokus ke pencarian</span>
                </div>
            </div>
        );

        // ==================== EMBEDDED DATABASE ====================
        // Data embedded directly to avoid CORS issues when opening file locally
        // ==================== GITHUB ADMIN INTEGRATION ====================

        // UTF-8 safe base64 decode (atob only handles ASCII/Latin-1, not multi-byte chars like emojis)
        function decodeBase64Utf8(base64) {
            const binString = atob(base64);
            const bytes = Uint8Array.from(binString, (c) => c.charCodeAt(0));
            return new TextDecoder('utf-8').decode(bytes);
        }

        const GITHUB_CONFIG = {
            OWNER: 'krisandi89',
            REPO: 'multibangun-smart-database',
            BRANCH: 'main'
        };

        class GithubService {
            constructor(token) {
                this.token = token;
                this.baseUrl = `https://api.github.com/repos/${GITHUB_CONFIG.OWNER}/${GITHUB_CONFIG.REPO}`;
            }

            async getHeaders() {
                return {
                    'Authorization': `token ${this.token}`,
                    'Accept': 'application/vnd.github.v3+json',
                    'Content-Type': 'application/json',
                };
            }

            // Validate if token is valid and has correct permissions
            async validateToken() {
                try {
                    const response = await fetch(`${this.baseUrl}`, {
                        headers: await this.getHeaders()
                    });
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        if (response.status === 401) {
                            throw new Error('Token tidak valid atau sudah expired. Silakan generate token baru di GitHub.');
                        }
                        if (response.status === 403) {
                            throw new Error('Token tidak memiliki permission yang cukup. Pastikan token memiliki scope "repo".');
                        }
                        throw new Error(errorData.message || 'Gagal validasi token');
                    }
                    return true;
                } catch (error) {
                    throw error;
                }
            }

            async getFile(path) {
                const response = await fetch(`${this.baseUrl}/contents/${path}?ref=${GITHUB_CONFIG.BRANCH}`, {
                    headers: await this.getHeaders()
                });
                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (response.status === 401) {
                        throw new Error('Token tidak valid. Silakan logout dan masukkan token baru.');
                    }
                    if (response.status === 404) {
                        throw new Error(`File "${path}" tidak ditemukan di repository.`);
                    }
                    throw new Error(errorData.message || 'Gagal membaca file dari GitHub');
                }
                return await response.json();
            }

            async uploadFile(path, contentBase64, message) {
                let sha = null;
                try {
                    const existing = await this.getFile(path);
                    sha = existing.sha;
                } catch (e) {
                    // File doesn't exist yet, that's ok for new files
                    if (!e.message.includes('tidak ditemukan')) {
                        throw e;
                    }
                }

                const body = {
                    message: message,
                    content: contentBase64,
                    branch: GITHUB_CONFIG.BRANCH
                };
                if (sha) body.sha = sha;

                const response = await fetch(`${this.baseUrl}/contents/${path}`, {
                    method: 'PUT',
                    headers: await this.getHeaders(),
                    body: JSON.stringify(body)
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    if (response.status === 401) {
                        throw new Error('Token tidak valid. Silakan logout dan masukkan token baru.');
                    }
                    if (response.status === 403) {
                        throw new Error('Tidak memiliki izin untuk mengupload. Pastikan token memiliki scope "repo".');
                    }
                    if (response.status === 409) {
                        throw new Error('Konflik: File sedang dimodifikasi. Coba lagi dalam beberapa detik.');
                    }
                    if (response.status === 422) {
                        throw new Error('File terlalu besar atau format tidak valid.');
                    }
                    throw new Error(errorData.message || 'Gagal upload file ke GitHub');
                }
                return await response.json();
            }

            async updateDataJson(newItem) {
                const fileData = await this.getFile('data.json');
                const content = JSON.parse(decodeBase64Utf8(fileData.content));
                content.items.push(newItem);
                const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                await this.uploadFile('data.json', newContent, `Add product: ${newItem.title}`);
                return content;
            }

            async addFileToExistingProduct(productId, newFile) {
                const fileData = await this.getFile('data.json');
                const content = JSON.parse(decodeBase64Utf8(fileData.content));
                const itemIndex = content.items.findIndex(item => item.id === productId);
                if (itemIndex === -1) throw new Error('Produk tidak ditemukan');
                content.items[itemIndex].files.push(newFile);
                const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                await this.uploadFile('data.json', newContent, `Add file to: ${content.items[itemIndex].title}`);
                return content;
            }

            async deleteProduct(productId) {
                const fileData = await this.getFile('data.json');
                const content = JSON.parse(decodeBase64Utf8(fileData.content));
                const itemIndex = content.items.findIndex(item => item.id === productId);
                if (itemIndex === -1) throw new Error('Produk tidak ditemukan');
                const deletedTitle = content.items[itemIndex].title;
                content.items.splice(itemIndex, 1);
                const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                await this.uploadFile('data.json', newContent, `Delete product: ${deletedTitle}`);
                return content;
            }

            async deleteFile(productId, fileIndex) {
                const fileData = await this.getFile('data.json');
                const content = JSON.parse(decodeBase64Utf8(fileData.content));
                const itemIndex = content.items.findIndex(item => item.id === productId);
                if (itemIndex === -1) throw new Error('Produk tidak ditemukan');
                const deletedFileName = content.items[itemIndex].files[fileIndex]?.name || 'file';
                content.items[itemIndex].files.splice(fileIndex, 1);
                // If no files left, keep product but with empty files array
                const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                await this.uploadFile('data.json', newContent, `Delete file: ${deletedFileName}`);
                return content;
            }

            async getDataJson() {
                const fileData = await this.getFile('data.json');
                return JSON.parse(decodeBase64Utf8(fileData.content));
            }

            // Category Management
            async addCategory(newCategory) {
                const fileData = await this.getFile('data.json');
                const content = JSON.parse(decodeBase64Utf8(fileData.content));
                content.categories.push(newCategory);
                const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                await this.uploadFile('data.json', newContent, `Add category: ${newCategory.name}`);
                return content;
            }

            async updateCategory(categoryId, updates) {
                const fileData = await this.getFile('data.json');
                const content = JSON.parse(decodeBase64Utf8(fileData.content));
                const idx = content.categories.findIndex(c => c.id === categoryId);
                if (idx === -1) throw new Error('Kategori tidak ditemukan');
                content.categories[idx] = { ...content.categories[idx], ...updates };
                const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                await this.uploadFile('data.json', newContent, `Update category: ${categoryId}`);
                return content;
            }

            async deleteCategory(categoryId) {
                const fileData = await this.getFile('data.json');
                const content = JSON.parse(decodeBase64Utf8(fileData.content));
                const inUse = content.items.some(item => item.category === categoryId);
                if (inUse) throw new Error('Kategori masih digunakan oleh produk. Hapus atau pindahkan produk terlebih dahulu.');
                const idx = content.categories.findIndex(c => c.id === categoryId);
                if (idx === -1) throw new Error('Kategori tidak ditemukan');
                content.categories.splice(idx, 1);
                const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                await this.uploadFile('data.json', newContent, `Delete category: ${categoryId}`);
                return content;
            }

            // File Type Management
            async addFileType(newFileType) {
                const fileData = await this.getFile('data.json');
                const content = JSON.parse(decodeBase64Utf8(fileData.content));
                if (!content.fileTypes) content.fileTypes = [];
                content.fileTypes.push(newFileType);
                const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                await this.uploadFile('data.json', newContent, `Add file type: ${newFileType.label}`);
                return content;
            }

            async updateFileType(fileTypeId, updates) {
                const fileData = await this.getFile('data.json');
                const content = JSON.parse(decodeBase64Utf8(fileData.content));
                if (!content.fileTypes) throw new Error('File types belum ada');
                const idx = content.fileTypes.findIndex(f => f.id === fileTypeId);
                if (idx === -1) throw new Error('Tipe file tidak ditemukan');
                content.fileTypes[idx] = { ...content.fileTypes[idx], ...updates };
                const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                await this.uploadFile('data.json', newContent, `Update file type: ${fileTypeId}`);
                return content;
            }

            async deleteFileType(fileTypeId) {
                const fileData = await this.getFile('data.json');
                const content = JSON.parse(decodeBase64Utf8(fileData.content));
                if (!content.fileTypes) throw new Error('File types belum ada');
                // Check if file type is in use
                const inUse = content.items.some(item => item.files.some(f => f.type === fileTypeId));
                if (inUse) throw new Error('Tipe file masih digunakan. Hapus atau ubah file yang menggunakan tipe ini terlebih dahulu.');
                const idx = content.fileTypes.findIndex(f => f.id === fileTypeId);
                if (idx === -1) throw new Error('Tipe file tidak ditemukan');
                content.fileTypes.splice(idx, 1);
                const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                await this.uploadFile('data.json', newContent, `Delete file type: ${fileTypeId}`);
                return content;
            }

            // Product Update
            async updateProduct(productId, updates) {
                const fileData = await this.getFile('data.json');
                const content = JSON.parse(decodeBase64Utf8(fileData.content));
                const idx = content.items.findIndex(item => item.id === productId);
                if (idx === -1) throw new Error('Produk tidak ditemukan');
                content.items[idx] = { ...content.items[idx], ...updates };
                const newContent = btoa(unescape(encodeURIComponent(JSON.stringify(content, null, 2))));
                await this.uploadFile('data.json', newContent, `Update product: ${content.items[idx].title}`);
                return content;
            }
        }

        // Delete Confirmation Modal
        const DeleteConfirmModal = ({ isOpen, onClose, onConfirm, itemName, isDeleting }) => {
            if (!isOpen) return null;
            return (
                <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                    <div className="bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-sm p-6">
                        <div className="text-center mb-4">
                            <div className="w-14 h-14 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center mx-auto mb-3">
                                <svg className="w-7 h-7 text-red-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                </svg>
                            </div>
                            <h4 className="font-bold text-lg mb-2">Hapus Item?</h4>
                            <p className="text-sm text-slate-500 dark:text-slate-400">
                                Anda akan menghapus: <strong className="text-slate-700 dark:text-slate-200">{itemName}</strong>
                            </p>
                            <p className="text-xs text-red-500 mt-2">Tindakan ini tidak dapat dibatalkan!</p>
                        </div>
                        <div className="flex gap-3">
                            <button onClick={onClose} disabled={isDeleting} className="flex-1 py-2.5 px-4 rounded-lg border border-slate-300 dark:border-slate-600 font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition disabled:opacity-50">
                                Batal
                            </button>
                            <button onClick={onConfirm} disabled={isDeleting} className="flex-1 py-2.5 px-4 rounded-lg bg-red-600 hover:bg-red-700 text-white font-medium transition disabled:opacity-50 flex items-center justify-center gap-2">
                                {isDeleting ? (
                                    <><div className="animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"></div> Menghapus...</>
                                ) : 'üóëÔ∏è Hapus'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        const AdminModal = ({ isOpen, onClose, categories, fileTypes, items, onUploadSuccess }) => {
            const [activeTab, setActiveTab] = useState('upload'); // upload, manage, settings
            const [step, setStep] = useState('token'); // token, validating, main, uploading
            const [token, setToken] = useState(localStorage.getItem('gh_token') || '');
            const [uploadMode, setUploadMode] = useState('new'); // new, existing
            const [selectedProduct, setSelectedProduct] = useState('');
            const [formData, setFormData] = useState({
                title: '',
                category: '',
                description: '',
                fileType: 'brosur',
                file: null
            });
            const [logs, setLogs] = useState([]);
            const [manageSearch, setManageSearch] = useState('');
            const [expandedProduct, setExpandedProduct] = useState(null);
            const [deleteModal, setDeleteModal] = useState({ open: false, type: '', productId: null, fileIndex: null, name: '' });
            const [isDeleting, setIsDeleting] = useState(false);
            const [error, setError] = useState('');

            // Settings state
            const [settingsTab, setSettingsTab] = useState('categories'); // categories, fileTypes
            const [newCategory, setNewCategory] = useState({ id: '', name: '', color: 'bg-blue-600' });
            const [newFileType, setNewFileType] = useState({ id: '', label: '', icon: 'üìÑ', badge: 'badge-brosur' });
            const [isProcessing, setIsProcessing] = useState(false);

            // Edit Product state
            const [editProduct, setEditProduct] = useState(null);
            const [editFormData, setEditFormData] = useState({ title: '', description: '', category: '' });

            // Quick-add modal state
            const [quickAddModal, setQuickAddModal] = useState({ open: false, type: '' }); // type: 'category' or 'fileType'

            // Color options for categories
            const colorOptions = [
                'bg-slate-600', 'bg-blue-600', 'bg-emerald-600', 'bg-purple-600',
                'bg-amber-600', 'bg-green-600', 'bg-orange-600', 'bg-cyan-600',
                'bg-rose-600', 'bg-indigo-600', 'bg-pink-600', 'bg-teal-600'
            ];

            // Badge options for file types
            const badgeOptions = [
                'badge-brosur', 'badge-spesifikasi', 'badge-metode', 'badge-hasil-uji',
                'badge-sertifikasi', 'badge-case-history', 'badge-presentasi'
            ];

            const addLog = (msg) => setLogs(prev => [...prev, msg]);

            const handleSaveToken = async () => {
                if (!token) return;
                setError('');
                setStep('validating');
                try {
                    const gh = new GithubService(token);
                    await gh.validateToken();
                    localStorage.setItem('gh_token', token);
                    setStep('main');
                } catch (err) {
                    setError(err.message);
                    setStep('token');
                }
            };

            const handleLogout = () => {
                localStorage.removeItem('gh_token');
                setToken('');
                setStep('token');
            };

            const handleFileChange = (e) => {
                if (e.target.files[0]) {
                    setFormData({ ...formData, file: e.target.files[0] });
                }
            };

            const handleSubmit = async (e) => {
                e.preventDefault();
                setStep('uploading');
                setLogs([]);
                addLog('üîÑ Memulai proses upload...');

                try {
                    const gh = new GithubService(token);
                    addLog('üìÇ Membaca file...');
                    const reader = new FileReader();
                    reader.readAsDataURL(formData.file);

                    reader.onload = async () => {
                        try {
                            const base64Content = reader.result.split(',')[1];
                            const filePath = `Assets/New/${formData.file.name}`;
                            addLog(`‚¨ÜÔ∏è Mengupload file ke: ${filePath}`);
                            await gh.uploadFile(filePath, base64Content, `Upload: ${formData.file.name}`);
                            addLog('‚úÖ File berhasil diupload!');

                            const newFile = {
                                name: formData.file.name,
                                path: filePath,
                                type: formData.fileType,
                                size: (formData.file.size / 1024 / 1024).toFixed(1) + ' MB',
                                gdriveId: ''
                            };

                            if (uploadMode === 'existing' && selectedProduct) {
                                addLog('üìù Menambahkan file ke produk existing...');
                                await gh.addFileToExistingProduct(parseInt(selectedProduct), newFile);
                                addLog('‚úÖ File ditambahkan ke produk!');
                            } else {
                                addLog('üìù Membuat produk baru...');
                                const newItem = {
                                    id: Date.now(),
                                    title: formData.title,
                                    category: formData.category,
                                    subcategory: null,
                                    tags: ["new", formData.category],
                                    description: formData.description,
                                    highlight: false,
                                    files: [newFile]
                                };
                                await gh.updateDataJson(newItem);
                                addLog('‚úÖ Produk baru dibuat!');
                            }

                            addLog('üéâ Selesai! Tunggu Vercel deploy 1-2 menit.');
                            setTimeout(() => {
                                onUploadSuccess();
                                onClose();
                                setStep('main');
                                setFormData({ title: '', category: '', description: '', fileType: 'brosur', file: null });
                                setUploadMode('new');
                                setSelectedProduct('');
                            }, 2000);
                        } catch (error) {
                            addLog(`‚ùå Error: ${error.message}`);
                        }
                    };
                } catch (error) {
                    addLog(`‚ùå Error sistem: ${error.message}`);
                }
            };

            const handleDelete = async () => {
                setIsDeleting(true);
                setError('');
                try {
                    const gh = new GithubService(token);
                    if (deleteModal.type === 'product') {
                        await gh.deleteProduct(deleteModal.productId);
                    } else {
                        await gh.deleteFile(deleteModal.productId, deleteModal.fileIndex);
                    }
                    setDeleteModal({ open: false, type: '', productId: null, fileIndex: null, name: '' });
                    onUploadSuccess();
                } catch (err) {
                    setError('Gagal menghapus: ' + err.message);
                    setDeleteModal({ open: false, type: '', productId: null, fileIndex: null, name: '' });
                }
                setIsDeleting(false);
            };

            const filteredItems = items.filter(item =>
                item.title.toLowerCase().includes(manageSearch.toLowerCase()) ||
                item.category.toLowerCase().includes(manageSearch.toLowerCase())
            );

            const getStorageIcon = (file) => {
                if (file.gdriveId && file.gdriveId !== '') return '‚òÅÔ∏è';
                return 'üìÅ';
            };

            // Category handlers
            // Category handlers
            const handleAddCategory = async () => {
                if (!newCategory.id || !newCategory.name) {
                    setError('ID dan Nama kategori wajib diisi');
                    return false;
                }
                setIsProcessing(true);
                setError('');
                try {
                    const gh = new GithubService(token);
                    await gh.addCategory({ ...newCategory, icon: 'folder' });
                    setNewCategory({ id: '', name: '', color: 'bg-blue-600' });
                    onUploadSuccess();
                    setIsProcessing(false);
                    return true;
                } catch (err) {
                    setError(err.message);
                    setIsProcessing(false);
                    return false;
                }
            };

            const handleDeleteCategory = async (categoryId) => {
                setIsProcessing(true);
                setError('');
                try {
                    const gh = new GithubService(token);
                    await gh.deleteCategory(categoryId);
                    onUploadSuccess();
                } catch (err) {
                    setError(err.message);
                }
                setIsProcessing(false);
            };

            // File Type handlers
            // File Type handlers
            const handleAddFileType = async () => {
                if (!newFileType.id || !newFileType.label) {
                    setError('ID dan Label tipe file wajib diisi');
                    return false;
                }
                setIsProcessing(true);
                setError('');
                try {
                    const gh = new GithubService(token);
                    await gh.addFileType(newFileType);
                    setNewFileType({ id: '', label: '', icon: 'üìÑ', badge: 'badge-brosur' });
                    onUploadSuccess();
                    setIsProcessing(false);
                    return true;
                } catch (err) {
                    setError(err.message);
                    setIsProcessing(false);
                    return false;
                }
            };

            const handleDeleteFileType = async (fileTypeId) => {
                setIsProcessing(true);
                setError('');
                try {
                    const gh = new GithubService(token);
                    await gh.deleteFileType(fileTypeId);
                    onUploadSuccess();
                } catch (err) {
                    setError(err.message);
                }
                setIsProcessing(false);
            };

            // Edit Product handlers
            const handleEditProduct = (product) => {
                setEditProduct(product);
                setEditFormData({
                    title: product.title,
                    description: product.description,
                    category: product.category
                });
            };

            const handleSaveEditProduct = async () => {
                if (!editFormData.title || !editFormData.category) {
                    setError('Judul dan kategori wajib diisi');
                    return;
                }
                setIsProcessing(true);
                setError('');
                try {
                    const gh = new GithubService(token);
                    await gh.updateProduct(editProduct.id, editFormData);
                    setEditProduct(null);
                    onUploadSuccess();
                } catch (err) {
                    setError(err.message);
                }
                setIsProcessing(false);
            };

            if (!isOpen) return null;

            return (
                <>
                    <DeleteConfirmModal
                        isOpen={deleteModal.open}
                        onClose={() => setDeleteModal({ open: false, type: '', productId: null, fileIndex: null, name: '' })}
                        onConfirm={handleDelete}
                        itemName={deleteModal.name}
                        isDeleting={isDeleting}
                    />

                    {/* Quick-Add Modal */}
                    {quickAddModal.open && (
                        <div className="fixed inset-0 z-[70] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                            <div className="bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-md p-6">
                                <h4 className="font-bold text-lg mb-4">
                                    {quickAddModal.type === 'category' ? 'üè∑Ô∏è Tambah Kategori Baru' : 'üìÑ Tambah Tipe File Baru'}
                                </h4>
                                {error && (
                                    <div className="p-2 mb-3 rounded-lg bg-red-100 dark:bg-red-900/30 text-sm text-red-600 dark:text-red-400">
                                        ‚ùå {error}
                                    </div>
                                )}

                                {quickAddModal.type === 'category' ? (
                                    <div className="space-y-3">
                                        <div>
                                            <label className="block text-xs font-bold uppercase mb-1">ID Kategori</label>
                                            <input
                                                type="text"
                                                placeholder="contoh: drainage"
                                                value={newCategory.id}
                                                onChange={e => setNewCategory({ ...newCategory, id: e.target.value.toLowerCase().replace(/\s+/g, '-') })}
                                                className="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold uppercase mb-1">Nama Kategori</label>
                                            <input
                                                type="text"
                                                placeholder="contoh: Drainage System"
                                                value={newCategory.name}
                                                onChange={e => setNewCategory({ ...newCategory, name: e.target.value })}
                                                className="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold uppercase mb-1">Warna</label>
                                            <div className="flex gap-1 flex-wrap">
                                                {colorOptions.map(color => (
                                                    <button
                                                        key={color}
                                                        type="button"
                                                        onClick={() => setNewCategory({ ...newCategory, color })}
                                                        className={`w-6 h-6 rounded-full ${color} ${newCategory.color === color ? 'ring-2 ring-offset-1 ring-blue-500' : ''}`}
                                                    />
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="space-y-3">
                                        <div>
                                            <label className="block text-xs font-bold uppercase mb-1">ID Tipe File</label>
                                            <input
                                                type="text"
                                                placeholder="contoh: tutorial"
                                                value={newFileType.id}
                                                onChange={e => setNewFileType({ ...newFileType, id: e.target.value.toLowerCase().replace(/\s+/g, '-') })}
                                                className="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-xs font-bold uppercase mb-1">Label Tampilan</label>
                                            <input
                                                type="text"
                                                placeholder="contoh: Tutorial"
                                                value={newFileType.label}
                                                onChange={e => setNewFileType({ ...newFileType, label: e.target.value })}
                                                className="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600"
                                            />
                                        </div>
                                        <div className="flex gap-4">
                                            <div className="flex-1">
                                                <label className="block text-xs font-bold uppercase mb-1">Icon</label>
                                                <input
                                                    type="text"
                                                    value={newFileType.icon}
                                                    onChange={e => setNewFileType({ ...newFileType, icon: e.target.value })}
                                                    className="w-full p-2 rounded border text-center dark:bg-slate-700 dark:border-slate-600"
                                                />
                                            </div>
                                            <div className="flex-1">
                                                <label className="block text-xs font-bold uppercase mb-1">Badge Style</label>
                                                <select
                                                    value={newFileType.badge}
                                                    onChange={e => setNewFileType({ ...newFileType, badge: e.target.value })}
                                                    className="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600 text-sm"
                                                >
                                                    {badgeOptions.map(b => <option key={b} value={b}>{b.replace('badge-', '')}</option>)}
                                                </select>
                                            </div>
                                        </div>
                                    </div>
                                )}

                                <div className="flex gap-3 mt-4">
                                    <button
                                        onClick={() => { setQuickAddModal({ open: false, type: '' }); setError(''); }}
                                        disabled={isProcessing}
                                        className="flex-1 py-2.5 px-4 rounded-lg border border-slate-300 dark:border-slate-600 font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition disabled:opacity-50"
                                    >
                                        Batal
                                    </button>
                                    <button
                                        onClick={async () => {
                                            if (quickAddModal.type === 'category') {
                                                const success = await handleAddCategory();
                                                if (success) {
                                                    setQuickAddModal({ open: false, type: '' });
                                                }
                                            } else {
                                                const success = await handleAddFileType();
                                                if (success) {
                                                    setQuickAddModal({ open: false, type: '' });
                                                }
                                            }
                                        }}
                                        disabled={isProcessing}
                                        className="flex-1 py-2.5 px-4 rounded-lg bg-green-600 hover:bg-green-700 text-white font-medium transition disabled:opacity-50"
                                    >
                                        {isProcessing ? '‚è≥ Menyimpan...' : '‚ûï Tambah'}
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm animate-fade-in">
                        <div className="bg-white dark:bg-slate-800 rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]">
                            {/* Header */}
                            <div className="p-4 border-b dark:border-slate-700 flex justify-between items-center bg-slate-50 dark:bg-slate-900">
                                <h3 className="font-bold text-lg">‚öôÔ∏è Admin Mode</h3>
                                <div className="flex items-center gap-2">
                                    {step === 'main' && (
                                        <button onClick={handleLogout} className="text-xs text-slate-500 hover:text-red-500 transition">Logout</button>
                                    )}
                                    <button onClick={onClose}><Icons.X className="w-6 h-6" /></button>
                                </div>
                            </div>

                            {/* Content */}
                            <div className="flex-1 overflow-hidden flex flex-col">
                                {step === 'token' && (
                                    <div className="p-6 space-y-4">
                                        <p className="text-sm">Masukkan GitHub Personal Access Token (PAT) untuk izin kelola database.</p>
                                        {error && (
                                            <div className="p-3 rounded-lg bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700">
                                                <p className="text-sm text-red-600 dark:text-red-400">‚ùå {error}</p>
                                            </div>
                                        )}
                                        <input
                                            type="password"
                                            value={token}
                                            onChange={e => { setToken(e.target.value); setError(''); }}
                                            placeholder="ghp_xxxxxxxxxxxx"
                                            className="w-full p-3 rounded-lg border dark:bg-slate-700 dark:border-slate-600"
                                        />
                                        <button onClick={handleSaveToken} className="w-full py-3 bg-blue-600 text-white rounded-lg font-bold hover:bg-blue-700 transition">Lanjut</button>
                                        <p className="text-xs text-slate-400">*Token akan disimpan di browser Anda. Pastikan token memiliki scope "repo".</p>
                                        <a href="https://github.com/settings/tokens/new?description=Multibangun%20Database&scopes=repo" target="_blank" rel="noreferrer" className="block text-xs text-blue-500 hover:underline">‚Üí Buat token baru di GitHub</a>
                                    </div>
                                )}

                                {step === 'validating' && (
                                    <div className="p-6 text-center space-y-4">
                                        <div className="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600 mx-auto"></div>
                                        <p className="font-medium">Memvalidasi token...</p>
                                    </div>
                                )}

                                {step === 'main' && (
                                    <>
                                        {/* Tabs */}
                                        <div className="flex border-b dark:border-slate-700">
                                            <button
                                                onClick={() => setActiveTab('upload')}
                                                className={`flex-1 py-2 text-xs font-semibold transition-colors ${activeTab === 'upload' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50 dark:bg-blue-900/20' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}
                                            >
                                                üì§ Upload
                                            </button>
                                            <button
                                                onClick={() => setActiveTab('manage')}
                                                className={`flex-1 py-2 text-xs font-semibold transition-colors ${activeTab === 'manage' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50 dark:bg-blue-900/20' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}
                                            >
                                                üóÇÔ∏è Database
                                            </button>
                                            <button
                                                onClick={() => setActiveTab('settings')}
                                                className={`flex-1 py-2 text-xs font-semibold transition-colors ${activeTab === 'settings' ? 'text-blue-600 border-b-2 border-blue-600 bg-blue-50 dark:bg-blue-900/20' : 'text-slate-500 hover:text-slate-700 dark:hover:text-slate-300'}`}
                                            >
                                                ‚öôÔ∏è Settings
                                            </button>
                                        </div>

                                        {/* Tab Content */}
                                        <div className="flex-1 overflow-y-auto p-6">
                                            {activeTab === 'upload' && (
                                                <form onSubmit={handleSubmit} className="space-y-4">
                                                    {/* Upload Mode Toggle */}
                                                    <div>
                                                        <label className="block text-xs font-bold uppercase mb-2">Tambah ke</label>
                                                        <div className="flex gap-2">
                                                            <button type="button" onClick={() => setUploadMode('new')}
                                                                className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition ${uploadMode === 'new' ? 'bg-blue-600 text-white' : 'bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300'}`}>
                                                                ‚ûï Produk Baru
                                                            </button>
                                                            <button type="button" onClick={() => setUploadMode('existing')}
                                                                className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition ${uploadMode === 'existing' ? 'bg-blue-600 text-white' : 'bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300'}`}>
                                                                üìÇ Produk Existing
                                                            </button>
                                                        </div>
                                                    </div>

                                                    {uploadMode === 'existing' && (
                                                        <div>
                                                            <label className="block text-xs font-bold uppercase mb-1">Pilih Produk</label>
                                                            <select required className="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600"
                                                                value={selectedProduct} onChange={e => setSelectedProduct(e.target.value)}>
                                                                <option value="">Pilih Produk...</option>
                                                                {items.map(item => (
                                                                    <option key={item.id} value={item.id}>{item.title} ({categoryConfig[item.category]?.label || item.category})</option>
                                                                ))}
                                                            </select>
                                                        </div>
                                                    )}

                                                    {uploadMode === 'new' && (
                                                        <>
                                                            <div>
                                                                <label className="block text-xs font-bold uppercase mb-1">Nama Produk</label>
                                                                <input required className="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600"
                                                                    value={formData.title} onChange={e => setFormData({ ...formData, title: e.target.value })} />
                                                            </div>
                                                            <div>
                                                                <label className="block text-xs font-bold uppercase mb-1">Kategori</label>
                                                                <div className="flex gap-2">
                                                                    <select required className="flex-1 p-2 rounded border dark:bg-slate-700 dark:border-slate-600"
                                                                        value={formData.category} onChange={e => setFormData({ ...formData, category: e.target.value })}>
                                                                        <option value="">Pilih Kategori...</option>
                                                                        {categories.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                                                                    </select>
                                                                    <button type="button" onClick={() => setQuickAddModal({ open: true, type: 'category' })}
                                                                        className="px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold transition" title="Tambah Kategori Baru">
                                                                        +
                                                                    </button>
                                                                </div>
                                                            </div>
                                                            <div>
                                                                <label className="block text-xs font-bold uppercase mb-1">Deskripsi</label>
                                                                <textarea required className="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600" rows="2"
                                                                    value={formData.description} onChange={e => setFormData({ ...formData, description: e.target.value })}></textarea>
                                                            </div>
                                                        </>
                                                    )}

                                                    {/* File Type */}
                                                    <div>
                                                        <label className="block text-xs font-bold uppercase mb-1">Tipe File</label>
                                                        <div className="flex gap-2">
                                                            <select className="flex-1 p-2 rounded border dark:bg-slate-700 dark:border-slate-600"
                                                                value={formData.fileType} onChange={e => setFormData({ ...formData, fileType: e.target.value })}>
                                                                {(fileTypes || []).map(ft => (
                                                                    <option key={ft.id} value={ft.id}>{ft.icon} {ft.label}</option>
                                                                ))}
                                                            </select>
                                                            <button type="button" onClick={() => setQuickAddModal({ open: true, type: 'fileType' })}
                                                                className="px-3 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold transition" title="Tambah Tipe File Baru">
                                                                +
                                                            </button>
                                                        </div>
                                                    </div>

                                                    {/* File Upload */}
                                                    <div>
                                                        <label className="block text-xs font-bold uppercase mb-1">File (PDF, max 50MB)</label>
                                                        <div className="border-2 border-dashed border-slate-300 dark:border-slate-600 rounded-lg p-4 text-center hover:bg-slate-50 dark:hover:bg-slate-700 transition cursor-pointer relative">
                                                            <input required type="file" accept=".pdf,.ppt,.pptx" onChange={handleFileChange} className="absolute inset-0 opacity-0 cursor-pointer" />
                                                            <Icons.Folder className="w-6 h-6 mx-auto text-slate-400 mb-1" />
                                                            <p className="text-sm font-medium">{formData.file ? formData.file.name : "Klik atau Drag file"}</p>
                                                        </div>
                                                    </div>

                                                    <button type="submit" className="w-full py-3 bg-green-600 hover:bg-green-700 text-white rounded-lg font-bold shadow-lg transition">
                                                        üöÄ Upload & Simpan
                                                    </button>
                                                </form>
                                            )}

                                            {activeTab === 'manage' && (
                                                <div className="space-y-4">
                                                    {/* Search */}
                                                    <div className="relative">
                                                        <Icons.Search className="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-400" />
                                                        <input
                                                            type="text"
                                                            value={manageSearch}
                                                            onChange={e => setManageSearch(e.target.value)}
                                                            placeholder="Cari produk..."
                                                            className="w-full pl-9 pr-4 py-2 rounded-lg border dark:bg-slate-700 dark:border-slate-600 text-sm"
                                                        />
                                                    </div>

                                                    {/* Stats */}
                                                    <div className="flex gap-4 text-xs text-slate-500">
                                                        <span>üì¶ {items.length} produk</span>
                                                        <span>üìÑ {items.reduce((acc, i) => acc + i.files.length, 0)} file</span>
                                                    </div>

                                                    {/* Error Message */}
                                                    {error && (
                                                        <div className="p-3 rounded-lg bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700">
                                                            <div className="flex items-center justify-between">
                                                                <p className="text-sm text-red-600 dark:text-red-400">‚ùå {error}</p>
                                                                <button onClick={() => setError('')} className="text-red-500 hover:text-red-700">
                                                                    <Icons.X className="w-4 h-4" />
                                                                </button>
                                                            </div>
                                                        </div>
                                                    )}

                                                    {/* Product List */}
                                                    <div className="space-y-2 max-h-[400px] overflow-y-auto">
                                                        {filteredItems.map(item => (
                                                            <div key={item.id} className="border dark:border-slate-700 rounded-lg overflow-hidden">
                                                                {/* Product Header */}
                                                                <div
                                                                    className="flex items-center justify-between p-3 cursor-pointer hover:bg-slate-50 dark:hover:bg-slate-700/50 transition"
                                                                    onClick={() => setExpandedProduct(expandedProduct === item.id ? null : item.id)}
                                                                >
                                                                    <div className="flex-1 min-w-0">
                                                                        <div className="flex items-center gap-2">
                                                                            <span className={`text-[10px] px-2 py-0.5 rounded-full text-white ${categoryConfig[item.category]?.color || 'bg-slate-500'}`}>
                                                                                {categoryConfig[item.category]?.label || item.category}
                                                                            </span>
                                                                            <span className="text-xs text-slate-400">{item.files.length} file</span>
                                                                        </div>
                                                                        <p className="font-medium text-sm mt-1 truncate">{item.title}</p>
                                                                    </div>
                                                                    <div className="flex items-center gap-2">
                                                                        <button
                                                                            onClick={(e) => { e.stopPropagation(); handleEditProduct(item); }}
                                                                            className="p-1.5 rounded-lg hover:bg-blue-100 dark:hover:bg-blue-900/30 text-slate-400 hover:text-blue-500 transition"
                                                                            title="Edit Produk"
                                                                        >
                                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z" /></svg>
                                                                        </button>
                                                                        <button
                                                                            onClick={(e) => { e.stopPropagation(); setDeleteModal({ open: true, type: 'product', productId: item.id, fileIndex: null, name: item.title }); }}
                                                                            className="p-1.5 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-slate-400 hover:text-red-500 transition"
                                                                            title="Hapus Produk"
                                                                        >
                                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                                                        </button>
                                                                        <Icons.ChevronRight className={`w-4 h-4 text-slate-400 transition-transform ${expandedProduct === item.id ? 'rotate-90' : ''}`} />
                                                                    </div>
                                                                </div>

                                                                {/* Expanded Files */}
                                                                {expandedProduct === item.id && (
                                                                    <div className="border-t dark:border-slate-700 bg-slate-50 dark:bg-slate-900 p-3 space-y-2">
                                                                        {item.files.map((file, idx) => (
                                                                            <div key={idx} className="flex items-center justify-between bg-white dark:bg-slate-800 rounded-lg p-2 text-sm">
                                                                                <div className="flex items-center gap-2 min-w-0 flex-1">
                                                                                    <span title={file.gdriveId ? 'Google Drive' : 'GitHub'}>{getStorageIcon(file)}</span>
                                                                                    <span className={`text-[10px] px-1.5 py-0.5 rounded ${fileTypeConfig[file.type]?.badge || 'bg-slate-100'}`}>
                                                                                        {fileTypeConfig[file.type]?.label || file.type}
                                                                                    </span>
                                                                                    <span className="truncate text-xs">{file.name}</span>
                                                                                </div>
                                                                                <button
                                                                                    onClick={() => setDeleteModal({ open: true, type: 'file', productId: item.id, fileIndex: idx, name: file.name })}
                                                                                    className="p-1 rounded hover:bg-red-100 dark:hover:bg-red-900/30 text-slate-400 hover:text-red-500 transition flex-shrink-0"
                                                                                    title="Hapus File"
                                                                                >
                                                                                    <svg className="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                                                                </button>
                                                                            </div>
                                                                        ))}
                                                                        {item.files.length === 0 && (
                                                                            <p className="text-xs text-slate-400 text-center py-2">Tidak ada file</p>
                                                                        )}
                                                                    </div>
                                                                )}
                                                            </div>
                                                        ))}
                                                        {filteredItems.length === 0 && (
                                                            <p className="text-center text-slate-400 py-8">Tidak ada produk ditemukan</p>
                                                        )}
                                                    </div>
                                                </div>
                                            )}

                                            {/* Settings Tab */}
                                            {activeTab === 'settings' && (
                                                <div className="space-y-4">
                                                    {/* Error Message */}
                                                    {error && (
                                                        <div className="p-3 rounded-lg bg-red-100 dark:bg-red-900/30 border border-red-300 dark:border-red-700">
                                                            <div className="flex items-center justify-between">
                                                                <p className="text-sm text-red-600 dark:text-red-400">‚ùå {error}</p>
                                                                <button onClick={() => setError('')} className="text-red-500 hover:text-red-700">
                                                                    <Icons.X className="w-4 h-4" />
                                                                </button>
                                                            </div>
                                                        </div>
                                                    )}

                                                    {/* Settings Sub-tabs */}
                                                    <div className="flex gap-2">
                                                        <button
                                                            onClick={() => setSettingsTab('categories')}
                                                            className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition ${settingsTab === 'categories' ? 'bg-blue-600 text-white' : 'bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300'}`}
                                                        >
                                                            üè∑Ô∏è Kategori
                                                        </button>
                                                        <button
                                                            onClick={() => setSettingsTab('fileTypes')}
                                                            className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition ${settingsTab === 'fileTypes' ? 'bg-blue-600 text-white' : 'bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-300'}`}
                                                        >
                                                            üìÑ Tipe File
                                                        </button>
                                                    </div>

                                                    {/* Categories Management */}
                                                    {settingsTab === 'categories' && (
                                                        <div className="space-y-4">
                                                            <h4 className="font-bold text-sm">Kategori ({categories.length})</h4>

                                                            {/* Add New Category */}
                                                            <div className="bg-slate-50 dark:bg-slate-900 p-3 rounded-lg space-y-2">
                                                                <p className="text-xs font-bold uppercase">Tambah Kategori Baru</p>
                                                                <div className="grid grid-cols-2 gap-2">
                                                                    <input
                                                                        type="text"
                                                                        placeholder="ID (contoh: drainage)"
                                                                        value={newCategory.id}
                                                                        onChange={e => setNewCategory({ ...newCategory, id: e.target.value.toLowerCase().replace(/\s+/g, '-') })}
                                                                        className="p-2 rounded border text-sm dark:bg-slate-700 dark:border-slate-600"
                                                                    />
                                                                    <input
                                                                        type="text"
                                                                        placeholder="Nama kategori"
                                                                        value={newCategory.name}
                                                                        onChange={e => setNewCategory({ ...newCategory, name: e.target.value })}
                                                                        className="p-2 rounded border text-sm dark:bg-slate-700 dark:border-slate-600"
                                                                    />
                                                                </div>
                                                                <div className="flex items-center gap-2">
                                                                    <span className="text-xs">Warna:</span>
                                                                    <div className="flex gap-1 flex-wrap">
                                                                        {colorOptions.map(color => (
                                                                            <button
                                                                                key={color}
                                                                                type="button"
                                                                                onClick={() => setNewCategory({ ...newCategory, color })}
                                                                                className={`w-5 h-5 rounded-full ${color} ${newCategory.color === color ? 'ring-2 ring-offset-1 ring-blue-500' : ''}`}
                                                                            />
                                                                        ))}
                                                                    </div>
                                                                </div>
                                                                <button
                                                                    onClick={handleAddCategory}
                                                                    disabled={isProcessing}
                                                                    className="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium disabled:opacity-50"
                                                                >
                                                                    {isProcessing ? '‚è≥ Menyimpan...' : '‚ûï Tambah Kategori'}
                                                                </button>
                                                            </div>

                                                            {/* Categories List */}
                                                            <div className="space-y-2 max-h-[250px] overflow-y-auto">
                                                                {categories.map(cat => (
                                                                    <div key={cat.id} className="flex items-center justify-between bg-white dark:bg-slate-800 p-2 rounded-lg border dark:border-slate-700">
                                                                        <div className="flex items-center gap-2">
                                                                            <span className={`w-4 h-4 rounded-full ${cat.color || 'bg-slate-500'}`}></span>
                                                                            <span className="text-sm font-medium">{cat.name}</span>
                                                                            <span className="text-xs text-slate-400">({cat.id})</span>
                                                                        </div>
                                                                        <button
                                                                            onClick={() => handleDeleteCategory(cat.id)}
                                                                            disabled={isProcessing}
                                                                            className="p-1 rounded hover:bg-red-100 dark:hover:bg-red-900/30 text-slate-400 hover:text-red-500 transition disabled:opacity-50"
                                                                            title="Hapus Kategori"
                                                                        >
                                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                                                        </button>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    )}

                                                    {/* File Types Management */}
                                                    {settingsTab === 'fileTypes' && (
                                                        <div className="space-y-4">
                                                            <h4 className="font-bold text-sm">Tipe File ({fileTypes?.length || 0})</h4>

                                                            {/* Add New File Type */}
                                                            <div className="bg-slate-50 dark:bg-slate-900 p-3 rounded-lg space-y-2">
                                                                <p className="text-xs font-bold uppercase">Tambah Tipe File Baru</p>
                                                                <div className="grid grid-cols-2 gap-2">
                                                                    <input
                                                                        type="text"
                                                                        placeholder="ID (contoh: tutorial)"
                                                                        value={newFileType.id}
                                                                        onChange={e => setNewFileType({ ...newFileType, id: e.target.value.toLowerCase().replace(/\s+/g, '-') })}
                                                                        className="p-2 rounded border text-sm dark:bg-slate-700 dark:border-slate-600"
                                                                    />
                                                                    <input
                                                                        type="text"
                                                                        placeholder="Label tampilan"
                                                                        value={newFileType.label}
                                                                        onChange={e => setNewFileType({ ...newFileType, label: e.target.value })}
                                                                        className="p-2 rounded border text-sm dark:bg-slate-700 dark:border-slate-600"
                                                                    />
                                                                </div>
                                                                <div className="flex items-center gap-2">
                                                                    <span className="text-xs">Icon:</span>
                                                                    <input
                                                                        type="text"
                                                                        value={newFileType.icon}
                                                                        onChange={e => setNewFileType({ ...newFileType, icon: e.target.value })}
                                                                        className="w-12 p-1 rounded border text-center dark:bg-slate-700 dark:border-slate-600"
                                                                    />
                                                                    <span className="text-xs">Badge:</span>
                                                                    <select
                                                                        value={newFileType.badge}
                                                                        onChange={e => setNewFileType({ ...newFileType, badge: e.target.value })}
                                                                        className="p-1 rounded border text-sm dark:bg-slate-700 dark:border-slate-600"
                                                                    >
                                                                        {badgeOptions.map(b => <option key={b} value={b}>{b}</option>)}
                                                                    </select>
                                                                </div>
                                                                <button
                                                                    onClick={handleAddFileType}
                                                                    disabled={isProcessing}
                                                                    className="w-full py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg text-sm font-medium disabled:opacity-50"
                                                                >
                                                                    {isProcessing ? '‚è≥ Menyimpan...' : '‚ûï Tambah Tipe File'}
                                                                </button>
                                                            </div>

                                                            {/* File Types List */}
                                                            <div className="space-y-2 max-h-[250px] overflow-y-auto">
                                                                {(fileTypes || []).map(ft => (
                                                                    <div key={ft.id} className="flex items-center justify-between bg-white dark:bg-slate-800 p-2 rounded-lg border dark:border-slate-700">
                                                                        <div className="flex items-center gap-2">
                                                                            <span>{ft.icon}</span>
                                                                            <span className={`text-xs px-1.5 py-0.5 rounded ${ft.badge}`}>{ft.label}</span>
                                                                            <span className="text-xs text-slate-400">({ft.id})</span>
                                                                        </div>
                                                                        <button
                                                                            onClick={() => handleDeleteFileType(ft.id)}
                                                                            disabled={isProcessing}
                                                                            className="p-1 rounded hover:bg-red-100 dark:hover:bg-red-900/30 text-slate-400 hover:text-red-500 transition disabled:opacity-50"
                                                                            title="Hapus Tipe File"
                                                                        >
                                                                            <svg className="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                                                                        </button>
                                                                    </div>
                                                                ))}
                                                            </div>
                                                        </div>
                                                    )}
                                                </div>
                                            )}
                                        </div>

                                        {/* Edit Product Modal */}
                                        {editProduct && (
                                            <div className="fixed inset-0 z-[60] flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
                                                <div className="bg-white dark:bg-slate-800 rounded-xl shadow-2xl w-full max-w-md p-6">
                                                    <h4 className="font-bold text-lg mb-4">‚úèÔ∏è Edit Produk</h4>
                                                    {error && (
                                                        <div className="p-2 mb-3 rounded-lg bg-red-100 dark:bg-red-900/30 text-sm text-red-600 dark:text-red-400">
                                                            ‚ùå {error}
                                                        </div>
                                                    )}
                                                    <div className="space-y-3">
                                                        <div>
                                                            <label className="block text-xs font-bold uppercase mb-1">Judul</label>
                                                            <input
                                                                type="text"
                                                                value={editFormData.title}
                                                                onChange={e => setEditFormData({ ...editFormData, title: e.target.value })}
                                                                className="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600"
                                                            />
                                                        </div>
                                                        <div>
                                                            <label className="block text-xs font-bold uppercase mb-1">Kategori</label>
                                                            <select
                                                                value={editFormData.category}
                                                                onChange={e => setEditFormData({ ...editFormData, category: e.target.value })}
                                                                className="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600"
                                                            >
                                                                {categories.map(c => <option key={c.id} value={c.id}>{c.name}</option>)}
                                                            </select>
                                                        </div>
                                                        <div>
                                                            <label className="block text-xs font-bold uppercase mb-1">Deskripsi</label>
                                                            <textarea
                                                                value={editFormData.description}
                                                                onChange={e => setEditFormData({ ...editFormData, description: e.target.value })}
                                                                rows="3"
                                                                className="w-full p-2 rounded border dark:bg-slate-700 dark:border-slate-600"
                                                            ></textarea>
                                                        </div>
                                                    </div>
                                                    <div className="flex gap-3 mt-4">
                                                        <button
                                                            onClick={() => { setEditProduct(null); setError(''); }}
                                                            disabled={isProcessing}
                                                            className="flex-1 py-2.5 px-4 rounded-lg border border-slate-300 dark:border-slate-600 font-medium hover:bg-slate-50 dark:hover:bg-slate-700 transition disabled:opacity-50"
                                                        >
                                                            Batal
                                                        </button>
                                                        <button
                                                            onClick={handleSaveEditProduct}
                                                            disabled={isProcessing}
                                                            className="flex-1 py-2.5 px-4 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium transition disabled:opacity-50"
                                                        >
                                                            {isProcessing ? '‚è≥ Menyimpan...' : 'üíæ Simpan'}
                                                        </button>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </>
                                )}

                                {step === 'uploading' && (
                                    <div className="p-6 space-y-3">
                                        <div className="flex justify-center mb-4">
                                            <div className="animate-spin rounded-full h-10 w-10 border-b-2 border-blue-600"></div>
                                        </div>
                                        <h4 className="text-center font-bold">Sedang Memproses...</h4>
                                        <div className="bg-slate-100 dark:bg-slate-900 p-3 rounded-lg font-mono text-xs space-y-1 max-h-40 overflow-y-auto">
                                            {logs.map((log, i) => <div key={i}>{log}</div>)}
                                        </div>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </>
            );
        };





        // ==================== MAIN APP ====================
        const MultibangunSmartDatabase = () => {
            const [database, setDatabase] = useState({ categories: [], items: [] });

            // Admin State
            const [isAdminOpen, setIsAdminOpen] = useState(false);

            const handleUploadSuccess = () => {
                setIsLoading(true);
                // Reload data to reflect changes
                setTimeout(() => {
                    fetch(`data.json?t=${new Date().getTime()}`)
                        .then(res => res.json())
                        .then(data => {
                            setDatabase(data);
                            setResults(data.items);
                            setIsLoading(false);
                        });
                }, 1500);
            };

            const [query, setQuery] = useState('');
            const [activeCategory, setActiveCategory] = useState('all');
            const [results, setResults] = useState([]);
            const [isLoading, setIsLoading] = useState(true);
            const [darkMode, setDarkMode] = useState(() => {
                if (typeof window !== 'undefined') {
                    const saved = localStorage.getItem('darkMode');
                    if (saved !== null) return saved === 'true';
                    return window.matchMedia('(prefers-color-scheme: dark)').matches;
                }
                return false;
            });
            const searchInputRef = useRef(null);

            // Toggle dark mode
            const toggleDarkMode = () => {
                setDarkMode(prev => {
                    const newValue = !prev;
                    localStorage.setItem('darkMode', newValue);
                    return newValue;
                });
            };

            // Apply dark mode class to body
            useEffect(() => {
                if (darkMode) {
                    document.documentElement.classList.add('dark');
                } else {
                    document.documentElement.classList.remove('dark');
                }
            }, [darkMode]);

            // Load database from data.json
            useEffect(() => {
                // Add timestamp to prevent caching
                fetch(`data.json?t=${new Date().getTime()}`)
                    .then(res => res.json())
                    .then(data => {
                        setDatabase(data);
                        setResults(data.items);
                        setIsLoading(false);
                    })
                    .catch(() => {
                        // Fallback to embedded if fetch fails (local file://)
                        setDatabase(EMBEDDED_DATABASE);
                        setResults(EMBEDDED_DATABASE.items);
                        setIsLoading(false);
                    });
            }, []);

            // Search & Filter
            useEffect(() => {
                let filtered = database.items;

                if (query) {
                    const lowerQuery = query.toLowerCase();
                    filtered = filtered.filter(item =>
                        item.title.toLowerCase().includes(lowerQuery) ||
                        item.description.toLowerCase().includes(lowerQuery) ||
                        item.tags.some(tag => tag.toLowerCase().includes(lowerQuery)) ||
                        (item.subcategory && item.subcategory.toLowerCase().includes(lowerQuery)) ||
                        item.files.some(f => f.name.toLowerCase().includes(lowerQuery))
                    );
                }

                if (activeCategory !== 'all') {
                    filtered = filtered.filter(item => item.category === activeCategory);
                }

                setResults(filtered);
            }, [query, activeCategory, database.items]);



            // Keyboard shortcut
            useEffect(() => {
                const handleKeyDown = (e) => {
                    if ((e.metaKey || e.ctrlKey) && e.key === 'k') {
                        e.preventDefault();
                        searchInputRef.current?.focus();
                    }
                    if (e.key === 'Escape') {
                        setQuery('');
                        searchInputRef.current?.blur();
                    }
                };
                window.addEventListener('keydown', handleKeyDown);
                return () => window.removeEventListener('keydown', handleKeyDown);
            }, []);

            // Main Assets folder ID (fallback for search)
            const GDRIVE_MAIN_FOLDER = '1ED8mMfEQHKM0wlOZBD9adW4F-8KJk96m';

            // Download handler - works for local and web
            const handleDownload = (file) => {
                const isLocal = window.location.protocol === 'file:';

                if (isLocal) {
                    // Local: direct file download
                    const link = document.createElement('a');
                    link.href = file.path;
                    link.download = file.name;
                    link.target = '_blank';
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                } else {
                    // Web: Use gdriveId from database
                    if (file.gdriveId) {
                        window.open(`https://drive.google.com/file/d/${file.gdriveId}/view`, '_blank');
                    } else if (file.gdriveId === '') {
                        // Direct Repo File (from Admin Upload)
                        window.open(file.path, '_blank');
                    } else {
                        // Fallback: Search in main folder (Legacy/Missing ID)
                        const fileName = file.path.split('/').pop();
                        window.open(`https://drive.google.com/drive/folders/${GDRIVE_MAIN_FOLDER}?q=${encodeURIComponent(fileName)}`, '_blank');
                    }
                }
            };

            // Category counts
            const categoryCounts = useMemo(() => {
                const counts = { all: database.items.length };
                database.items.forEach(item => {
                    counts[item.category] = (counts[item.category] || 0) + 1;
                });
                return counts;
            }, [database.items]);

            return (
                <div className="min-h-screen">

                    {/* Admin Modal */}
                    <AdminModal
                        isOpen={isAdminOpen}
                        onClose={() => setIsAdminOpen(false)}
                        categories={database.categories}
                        fileTypes={database.fileTypes}
                        items={database.items}
                        onUploadSuccess={handleUploadSuccess}
                    />

                    {/* Admin Toggle (Gear Icon) */}
                    <button
                        onClick={() => setIsAdminOpen(true)}
                        className="fixed top-4 right-16 z-40 p-2 rounded-lg bg-white/80 dark:bg-slate-800/80 backdrop-blur border border-slate-200 dark:border-slate-700 shadow-sm hover:scale-105 transition-all group"
                        title="Admin & Upload"
                    >
                        <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5 text-slate-500 group-hover:text-blue-600 dark:text-slate-400 dark:group-hover:text-blue-400 transition-colors" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path>
                        </svg>
                    </button>


                    {/* Theme Toggle */}
                    <button
                        onClick={toggleDarkMode}
                        className="theme-toggle"
                        aria-label="Toggle dark mode"
                    >
                        {darkMode ? (
                            <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" style={{ color: 'var(--text-primary)' }} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                <circle cx="12" cy="12" r="5" />
                                <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42" />
                            </svg>
                        ) : (
                            <svg xmlns="http://www.w3.org/2000/svg" className="w-5 h-5" style={{ color: 'var(--text-primary)' }} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                                <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                            </svg>
                        )}
                    </button>

                    {/* HERO / SPOTLIGHT */}
                    <div className="pt-16 pb-10 px-4 md:px-8">
                        <div className="max-w-4xl mx-auto text-center mb-10">
                            <h1 className="text-3xl md:text-5xl font-black mb-4 tracking-tight leading-tight" style={{ color: 'var(--text-primary)' }}>
                                Multibangun <span className="gradient-text">Smart</span> Database
                            </h1>
                            <p style={{ color: 'var(--text-secondary)' }} className="text-base md:text-lg max-w-2xl mx-auto">
                                Akses brosur, spesifikasi teknis, dan dokumentasi produk dalam hitungan detik
                            </p>
                        </div>

                        {/* Spotlight Search */}
                        <div className="max-w-3xl mx-auto relative">
                            <div className="relative spotlight-glow rounded-2xl transition-all duration-300" style={{ background: 'var(--search-bg)' }}>
                                <div className="absolute inset-y-0 left-0 pl-6 flex items-center pointer-events-none">
                                    <Icons.Search className={`w-6 h-6 transition-colors ${query ? 'text-red-500' : 'text-slate-400'}`} />
                                </div>
                                <input
                                    ref={searchInputRef}
                                    type="text"
                                    value={query}
                                    onChange={(e) => setQuery(e.target.value)}
                                    placeholder="Cari produk, brosur, atau spesifikasi..."
                                    className="w-full pl-16 pr-32 py-5 bg-transparent rounded-2xl text-lg focus:outline-none"
                                    style={{ color: 'var(--text-primary)' }}
                                    autoComplete="off"
                                />
                                <div className="absolute inset-y-0 right-4 flex items-center gap-2">
                                    {query && (
                                        <button
                                            onClick={() => setQuery('')}
                                            className="p-2 hover:bg-slate-100 dark:hover:bg-slate-700 rounded-lg transition-colors"
                                            style={{ color: 'var(--text-muted)' }}
                                        >
                                            <Icons.X className="w-5 h-5" />
                                        </button>
                                    )}
                                    <kbd className="hidden md:flex items-center gap-1 px-2 py-1.5 rounded-lg text-xs font-medium" style={{ background: 'var(--bg-secondary)', color: 'var(--text-muted)' }}>
                                        <Icons.Command className="w-3 h-3" /> K
                                    </kbd>
                                </div>
                            </div>

                            {/* Quick Stats */}
                            <div className="mt-4 flex items-center justify-center gap-6 text-sm" style={{ color: 'var(--text-muted)' }}>
                                <span>{database.items.length} produk</span>
                                <span>‚Ä¢</span>
                                <span>{database.items.reduce((acc, item) => acc + item.files.length, 0)} file</span>
                                <span>‚Ä¢</span>
                                <span>{database.categories.length} kategori</span>
                            </div>
                        </div>
                    </div>

                    {/* CONTENT */}
                    <main className="max-w-7xl mx-auto px-4 md:px-8 pb-24">

                        {/* Results */}
                        {!query && activeCategory === 'all' ? (
                            <InitialState />
                        ) : results.length > 0 ? (
                            <>
                                <p className="text-sm text-slate-400 mb-6">
                                    Menampilkan {results.length} hasil {query && `untuk "${query}"`}
                                </p>
                                <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                    {results.map((item) => (
                                        <ProductCard key={item.id} item={item} onDownload={handleDownload} />
                                    ))}
                                </div>
                            </>
                        ) : (
                            <EmptyState query={query} />
                        )}
                    </main>

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<MultibangunSmartDatabase />);
    </script>
</body>

</html>